<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Share File</title><link href="/static-assets/apps/sharefile/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/><style>:root{color-scheme:dark;--name-scroll-gap:3rem;--accent-color:#EAEAEA;--primary-color:#20ae51;--primary-text-color:#ffffff;--primary-font:monospace;}body{margin:0;padding:0;font-family:Arial,sans-serif;background:#1A1A1D;color:#E1E1E6;display:flex;flex-direction:column;align-items:center;min-height:100vh;}.uploadDiv{margin:40px 0 20px;display:flex;align-items:center;}.btn-svg-wrapper{position:relative;display:inline-block;}#dragText{height:100%;width:100%;position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);backdrop-filter:blur(3px);font-size:3rem;font-family:'Franklin Gothic Medium','Arial Narrow',Arial,sans-serif;z-index:2;pointer-events:none;}#btn-upload{display:inline-block;min-width:90px;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-size:16px;font-weight:bold;color:black;background-color:white;-webkit-tap-highlight-color:rgba(0,0,0,0);transition:0.8s;}#btn-upload:hover{background:#ffffff;color:#000000;box-shadow:0 0 5px #fff,0 0 25px #fff,0 0 50px #fff,0 0 200px #fff;transition:0.4s;}#btn-upload:active{transform:scale(0.97);transition:none;}#progress-bar{position:absolute;left:100%;top:50%;transform:translate(10px,-50%) rotate(-90deg);height:80px;width:80px;margin:auto;}#progress-bg{fill:none;stroke:var(--accent-color);stroke-width:5.5;stroke-linecap:round;visibility:hidden;}#progress-fg{fill:none;stroke:var(--primary-color);stroke-width:5.5;stroke-linecap:round;stroke-dasharray:100;stroke-dashoffset:100;}#progress-text{font-family:var(--primary-font);fill:var(--primary-text-color);font-weight:750;font-size:20px;text-anchor:middle;dominant-baseline:middle;transform-origin:48.5px 48.5px;transform:rotate(90deg);}#right-tick{position:absolute;left:100%;top:50%;transform:translate(10px,-50%);width:80px;height:80px;opacity:0;visibility:hidden;}#right-tick.fade-in{visibility:visible;animation:fadeIn 0.01s ease-in forwards;}#right-tick.fade-out{animation:fadeOut 0.5s ease-out forwards;}.fade-in{animation:fadeIn 0.01s ease-in forwards;}.fade-out{animation:fadeOut 0.1s ease-out forwards;}.tableDiv{width:80%;max-width:1200px;border:2px solid rgb(146,146,146);border-radius:10px;overflow:hidden;}.scrollInner{max-height:80vh;overflow:auto;}#fileTable{height:100%;width:100%;border-collapse:collapse;overflow:hidden;table-layout:auto;}#fileTable thead{background:#3A3A3F;}#fileTable th{padding:12px 16px;font-weight:bold;font-size:1rem;color:#fff;text-align:center;border-bottom:1px solid #454549;}#fileTable tbody tr{text-align:center;transition:background 0.2s ease;}#fileTable tbody tr:nth-child(odd){background:#2C2C2F;}#fileTable tbody tr:nth-child(even){background:#2F2F32;}#fileTable tbody tr:hover{background:#4a4a52;}#fileTable td{padding:12px 20px;font-size:0.95rem;border-bottom:1px solid #454549;white-space:nowrap;}.fileName{max-width:250px;overflow:hidden;position:relative;}.fileName.scrolling .scroll-content{display:inline-flex;white-space:nowrap;animation:scroll-left var(--duration) linear infinite;gap:var(--name-scroll-gap);}.fileName.scrolling:hover .scroll-content{animation-play-state:paused;}@keyframes scroll-left{0%{transform:translateX(0)}100%{transform:translateX(calc(-1 * var(--single-width) - var(--name-scroll-gap)))}}.btn-download{display:inline-block;padding:6px 12px;font-size:0.9rem;font-weight:bold;text-decoration:none;color:#fff;background:transparent;border:2px solid rgba(255,255,255,0.705);border-radius:8px;cursor:pointer;transition:background 0.2s ease,transform 0.1s ease;user-select:none;}.btn-download:hover{color:black;background:white;}.btn-download:active{transform:scale(0.97);transition:none;}.no-files{text-align:center;font-style:italic;color:#666;padding:1em 0;}.another-page{height:56px;position:absolute;right:40px;bottom:35px;display:inline-flex;align-items:center;justify-content:flex-end;background:transparent;border:2px solid white;border-radius:50px;overflow:hidden;max-width:56px;transition:max-width 0.35s ease;box-shadow:0 4px 14px rgba(0,0,0,0.25);}.another-page a{display:inline-flex;align-items:center;padding:8px;color:white;text-decoration:none;}.another-page img{display:block;width:40px;height:40px;}.hover-text{margin:0 10px;font-weight:bold;white-space:nowrap;opacity:0;transform:translateX(10px);transition:opacity 0.25s ease,transform 0.15s cubic-bezier(.175,.885,.32,1.275);}.another-page:hover{max-width:180px;}.another-page:hover .hover-text{opacity:1;transform:translateX(0);transition-delay:0.1s;}@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}@keyframes fadeOut{from{opacity:1;}to{opacity:0;}}@media (max-width:980px){.uploadDiv{margin:20px 0 20px;}.tableDiv{width:97%;}.scrollInner{max-height:70vh;}.fileName{max-width:180px;}}</style><link href="/static-assets/ui/zephyr-toast.css" rel="stylesheet"/><link href="/static-assets/ui/zephyr-toast-animate.css" rel="stylesheet"/><link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet"><script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" type="module"></script></link></head><body><input id="fileInput" multiple="" style="display: none;" type="file"/><div class="uploadDiv"><div class="btn-svg-wrapper"><button id="btn-upload">Upload</button><svg id="progress-bar" viewbox="0 0 100 100"><circle cx="50" cy="50" id="progress-bg" r="30"></circle><circle cx="50" cy="50" id="progress-fg" pathlength="100" r="30"></circle><text id="progress-text" x="50" y="50"></text></svg><dotlottie-player background="transparent" id="right-tick" speed="0.9" src="https://lottie.host/230968f9-47ee-453c-a80f-2f8307630aa6/6tJWJeWgyo.json"></dotlottie-player></div></div><div class="tableDiv" id="drop-zone"><div class="scrollInner"><div id="dragText" style="display: none;">Drop to Upload</div><table id="fileTable"><thead><tr><th>Filename</th><th>Uploaded</th><th>Size</th><th>Download</th></tr></thead><tbody class="tbody-rows"><td class="no-files" colspan="4">Files will be listed here</td></tbody></table></div></div><div class="another-page"><a draggable="false" id="anotherPageAnchor"><span class="hover-text">Share Text</span><img alt="Paste icon" draggable="false" src="/static-assets/apps/paste/images/paste.png"/></a></div><script defer="" src="/static-assets/ui/zephyr-toast.js"></script><script>document.addEventListener("DOMContentLoaded", () =>{window.formatByte = function (bytes) { if (bytes<= 0) { return '0 B'; } const units = ['B', 'K', 'M', 'G', 'T', 'PB', 'EB', 'ZB', 'YB']; const digitGroups = Math.floor(Math.log10(bytes) / Math.log10(1024)); const unit = units[digitGroups]; return `${(bytes / Math.pow(1024, digitGroups)).toFixed(unit === 'B' ? 0 : 1)} ${unit}`; }; window.formatTime = function (epoch, options = { sec: true }) { const { sec } = options; const date = new Date(epoch); const day = String(date.getDate()).padStart(2, '0'); const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']; const month = months[date.getMonth()]; const year = String(date.getFullYear()).slice(-2); const hours = String(date.getHours()).padStart(2, '0'); const minutes = String(date.getMinutes()).padStart(2, '0'); const seconds = String(date.getSeconds()).padStart(2, '0'); return day + '-' + month + '-' + year + '&nbsp;&nbsp;' + hours + ':' + minutes + (sec === true ? ':' + seconds : ''); }; window.isFolder = function (eventDataTransferItems) { const items = eventDataTransferItems; for (let i = 0; i< items.length; i++) { const entry = items[i].webkitGetAsEntry?.(); if (entry && entry.isDirectory) { return true; } } return false; }; window.setUploadProgress = function (value) { const v = Math.max(0, Math.min(100, value)); const fg = document.getElementById('progress-fg'); const txt = document.getElementById('progress-text'); fg.style.strokeDashoffset = 100 - v; txt.textContent = v + '%'; }; const progressBar = document.getElementById('progress-bar'); window.showProgressBar = function () { progressBar.classList.remove('fade-out'); progressBar.classList.add('fade-in'); progressBar.style.visibility = 'visible'; }; window.hideProgressBar = function () { progressBar.classList.remove('fade-in'); progressBar.classList.add('fade-out'); setTimeout(() =>{ progressBar.style.visibility = 'hidden'; }, 500); setTimeout(() =>{ setUploadProgress(0); }, 800); }; const right_tick = document.getElementById('right-tick'); window.showRightTick = function () { right_tick.classList.add('fade-in'); right_tick.style.visibility = 'visible'; right_tick.stop(); setTimeout(() =>{ right_tick.play(); }, 200); }; window.hideRightTick = function () { setTimeout(() =>{ right_tick.classList.add('fade-out'); }, 3000); setTimeout(() =>{ right_tick.classList.remove('fade-in'); right_tick.classList.remove('fade-out'); right_tick.style.visibility = 'hidden'; }, 4000); }; window.filterFiles = function (files) { const stats = window.storageStats; let maxSingleFileSize = stats.rule.maxTotalSize - stats.current.totalSize; const modifiedFiles = []; const rejectedFiles = []; let totalModifiedSize = 0; for (let i = 0; i< files?.length; i++) { const file = files[i]; if (file.size >maxSingleFileSize) { rejectedFiles.push(file); continue; } maxSingleFileSize -= file.size; totalModifiedSize += file.size; if (totalModifiedSize >stats.rule.maxTotalSize) { if (modifiedFiles.length >0) { toast.info(`Uploading first ${modifiedFiles.length} file${modifiedFiles.length >1 ? 's' : ''}`, { duration: 0 }); toast.warning('Total file size exceeded storage capacity', { duration: 0 }); } return modifiedFiles; } modifiedFiles.push(file); } if (rejectedFiles.length) { if (rejectedFiles.length >1) { toast.warning(`${rejectedFiles.length} files not uploaded: exceeds maximum allowed size`, { duration: 0 }); } else { toast.warning(`File '${rejectedFiles[0].name}' not uploaded: exceeds maximum allowed size`, { duration: 0 }); } } return modifiedFiles; }; const DOMAIN = 'sunamra.in'; const BASE_URI = `${window.location.protocol}//${DOMAIN}`; const API_BASE = `${BASE_URI}/apps/sharefile/api/v1`; const toast = new ZephyrToast({ position: 'bottom-left', duration: 5000 }); document.getElementById('anotherPageAnchor').href = `${BASE_URI}/apps/paste/`; window.nameCellArray = []; window.applyScrollingWrap = (cell) =>{ const addAnimation = (cellElem) =>{ const text = cellElem.textContent; cellElem.textContent = ''; const inner = document.createElement('div'); inner.classList.add('scroll-content'); inner.innerHTML = `<span>${text}</span><span>${text}</span>`; cellElem.appendChild(inner); const singleWidth = inner.children[0].offsetWidth; const speed = 30; const duration = singleWidth / speed; inner.style.setProperty('--single-width', `${singleWidth}px`); inner.style.setProperty('--duration', `${duration}s`); cellElem.classList.add('scrolling'); }; const removeAnimation = (cellElem) =>{ const wrapper = cellElem.querySelector('.scroll-content'); if (wrapper) { cellElem.classList.remove('scrolling'); const origText = wrapper.children[0]?.textContent; wrapper.remove(); cellElem.textContent = origText; } }; let div; let spans; let spanClientWidth; div = spanClientWidth = spans = null; if (cell.classList.contains('scrolling')) { div = cell.children[0]; spans = div?.querySelectorAll('span'); spanClientWidth = spans[0].clientWidth + 20; } const availableWidth = cell.clientWidth; const neededWidth = cell.scrollWidth; if (spanClientWidth && spanClientWidth< availableWidth) { removeAnimation(cell); } else if (neededWidth >availableWidth && !cell.classList.contains('scrolling')) { addAnimation(cell); } }; window.applyScrollingWrapToAll = (cells) =>{ cells.forEach(cell =>applyScrollingWrap(cell)); }; const uploadButton = document.getElementById('btn-upload'); window.postFile = (files) =>{ files = filterFiles(files); if (files.length == 0) { return; } const form = new FormData(); for (let i = 0; i< files.length; i++) { form.append('file', files[i]); } const xhr = new XMLHttpRequest(); xhr.open('POST', API_BASE); showProgressBar(); uploadButton.disabled = true; xhr.upload.onprogress = (e) =>{ if (!e.lengthComputable) return; const pct = ((e.loaded / e.total) * 100).toFixed(0); setUploadProgress(pct); }; xhr.onload = () =>{ let data; try { data = JSON.parse(xhr.responseText); } catch { console.error('Invalid JSON', xhr.responseText); toast.error('Unexpected server response'); hideProgressBar(); uploadButton.disabled = false; return; } if (data.success) { toast.success(data.message); hideProgressBar(); showRightTick(); hideRightTick(); } else { console.error(data.statusText || data.message || data); toast.error(data.statusText || data.message || 'Error posting file'); hideProgressBar(); } uploadButton.disabled = false; }; xhr.onerror = () =>{ console.error('Network error'); toast.error('Network error during upload'); }; xhr.send(form); }; window.listFiles = (files) =>{ const tableBody = document.getElementById('fileTable').querySelector('tbody'); tableBody.innerHTML = ''; if (files && files.length) { files.forEach(file =>{ const row = document.createElement('tr'); const nameCell = document.createElement('td'); nameCell.classList.add('fileName'); nameCell.textContent = nameCell.title = file.name; const uploadedCell = document.createElement('td'); uploadedCell.title = file.created; uploadedCell.innerHTML = formatTime(file.created, false); const sizeCell = document.createElement('td'); file.size >1024 ? sizeCell.title = file.size : ''; sizeCell.textContent = formatByte(file.size); const actionCell = document.createElement('td'); const downloadBtn = document.createElement('button'); downloadBtn.classList.add('btn-download'); downloadBtn.title = 'Download'; downloadBtn.innerHTML = '<i class="fa fa-download"></i>'; downloadBtn.setAttribute('onclick', `downloadFile('${file.serverName}')`); actionCell.appendChild(downloadBtn); window.nameCellArray.push(nameCell); row.append(nameCell, uploadedCell, sizeCell, actionCell); tableBody.prepend(row); }); } else { const noRow = document.createElement('tr'); const noCell = document.createElement('td'); noCell.setAttribute('colspan', '4'); noCell.classList.add('no-files'); noCell.textContent = files === null ? 'Internal Server Error' : 'No Files Available'; noRow.appendChild(noCell); tableBody.appendChild(noRow); } applyScrollingWrapToAll(window.nameCellArray); }; window.getFiles = () =>{ fetch(API_BASE) .then(res =>res.json()) .then(data =>{ if (data.success) { window.fetchedFiles = data.files; listFiles(data.files); } else { listFiles(null); throw new Error(data.message); } }) .catch(error =>{ console.error(error.message || error); toast.error(error.message || error); }); }; window.downloadFile = (filename) =>{ fetch(`${API_BASE}/${filename}`) .then(res =>{ return res.json(); }) .then(data =>{ if (data.success) { const a = document.createElement('a'); a.href = `${BASE_URI}/${data.publicStore}/${filename}`; a.download = data.filename; a.click(); a.remove(); } else { throw new Error(data.message); } }) .catch(error =>{ console.log(error); console.error(error.message || 5); toast.error(error.message || 5); }); }; window.fetchStorageStats = () =>{ fetch(`${API_BASE}/stats/storage`) .then(res =>res.json()) .then(data =>{ window.storageStats = data.stats; }) .catch(err =>{ console.error(err); }); }; const wsProtocol = window.location.protocol === 'https:' ? 'wss' : 'ws'; const ws = new WebSocket(`${wsProtocol}://${window.location.host}`); let debounceTimer; ws.onmessage = () =>{ clearTimeout(debounceTimer); debounceTimer = setTimeout(() =>{ getFiles(); fetchStorageStats(); }, 300); }; const dropZone = document.getElementById('drop-zone'); const dragText = document.getElementById('dragText'); let dragCounter = 0; dropZone.addEventListener('dragenter', e =>{ e.preventDefault(); if (dragCounter === 0) { dragText.style.display = 'flex'; } dragCounter++; }); dropZone.addEventListener('dragleave', e =>{ e.preventDefault(); dragCounter--; if (dragCounter === 0) { dragText.style.display = 'none'; } }); dropZone.addEventListener('dragover', e =>{ e.preventDefault(); }); dropZone.addEventListener('drop', e =>{ e.preventDefault(); dragCounter = 0; dragText.style.display = 'none'; e.preventDefault(); console.log(e.dataTransfer.files); if (!isFolder(e.dataTransfer.items)) { postFile(e.dataTransfer.files); } else { toast.warning('Folder not supported. Please select a file'); console.warn('Folder not supported. Please select a file'); } }); const uploadBtn = document.getElementById('btn-upload'); const fileInput = document.getElementById('fileInput'); uploadBtn.addEventListener('click', (e) =>{ e.preventDefault(); fileInput.click(); }); fileInput.addEventListener('change', () =>{ if (fileInput.files && fileInput.files.length >0) { postFile(fileInput.files); fileInput.value = ''; } else { console.error('No file selected'); toast.warning('No file selected'); } }); window.addEventListener('resize', (e) =>{ e.preventDefault(); applyScrollingWrapToAll(window.nameCellArray); });});</script></body></html>