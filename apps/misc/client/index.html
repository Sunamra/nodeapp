<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Render Shell</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
	<style>
		html,
		body {
			height: 100%;
			margin: 0;
			background: black;
		}

		#terminal {
			height: 100vh;
			width: 100vw;
		}
	</style>
</head>

<body>
	<div id="terminal"></div>
	<script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.7.0/lib/xterm-addon-fit.js"></script>
	<script>
		const term = new window.Terminal({ cursorBlink: true, cursorStyle: 'block', convertEol: true, cols: 80, rows: 24, theme: { background: '#000', foreground: '#fff', cursor: '#fff' } });
		const fitAddon = new window.FitAddon.FitAddon();
		term.loadAddon(fitAddon);
		term.open(document.getElementById('terminal'));
		fitAddon.fit();
		term.write('\x1b[90mConnecting...\x1b[0m\r\n');

		const protocol = (location.protocol === 'https:') ? 'wss' : 'ws';
		const portPart = location.port ? `:${location.port}` : '';
		const ws = new WebSocket(`${protocol}://${location.hostname}${portPart}`);

		ws.onopen = () => { term.clear(); term.focus(); };
		ws.onmessage = (evt) => { term.write(evt.data); };
		ws.onclose = () => { term.write('\r\n\x1b[31m[DEBUG] Connection closed\x1b[0m\r\n'); };
		ws.onerror = () => { term.write('\r\n\x1b[31m[ERROR] WebSocket error\x1b[0m\r\n'); };

		term.onData((data) => { if (ws.readyState === WebSocket.OPEN) ws.send(data); });
		window.addEventListener('resize', () => {
			fitAddon.fit();
			const dims = { type: 'resize', cols: term.cols, rows: term.rows };
			if (ws.readyState === WebSocket.OPEN) ws.send(JSON.stringify(dims));
		});
		ws.addEventListener('open', () => {
			ws.send(JSON.stringify({ type: 'resize', cols: term.cols, rows: term.rows }));
		});
	</script>
</body>

</html>